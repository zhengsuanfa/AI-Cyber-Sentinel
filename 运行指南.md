# AI Cyber Sentinel 运行指南 🛡️

## ✅ 问题已解决！

后端已成功运行！问题原因是：
- 后端默认使用 AI 模式调用 DeepSeek API
- API 调用失败导致服务崩溃
- 解决方案：配置为传统扫描模式（基于 AST 分析）

---

## 📋 系统架构

```
AI_Cyber_Sentinel/
├── backend/              # 后端服务（Node.js + Express）
│   ├── src/
│   │   ├── server.js    # 服务器入口
│   │   ├── routes/      # API 路由
│   │   ├── controllers/ # 控制器
│   │   └── services/    # 扫描服务
│   ├── .env             # 环境配置
│   └── package.json
├── src/                 # 前端（React + TypeScript + Vite）
│   ├── components/
│   └── App.tsx
└── package.json
```

---

## 🚀 快速启动

### 1️⃣ 启动后端服务

```bash
# 进入后端目录
cd backend

# 安装依赖（首次运行）
npm install

# 启动后端服务
npm start

# 或使用开发模式（自动重启）
npm run dev
```

✅ 后端运行在: `http://localhost:3001`
✅ 健康检查: `http://localhost:3001/api/health`

### 2️⃣ 启动前端服务

```bash
# 在项目根目录
cd ..

# 安装依赖（首次运行）
npm install

# 启动前端开发服务器
npm run dev
```

✅ 前端运行在: `http://localhost:3000`

---

## ⚙️ 配置说明

### 后端配置 (backend/.env)

```env
# 扫描模式
SCAN_MODE=traditional     # 使用传统 AST 分析模式（推荐）
# SCAN_MODE=ai            # 使用 DeepSeek AI 模式（需要有效 API Key）

# DeepSeek API 配置（仅 AI 模式需要）
DEEPSEEK_API_KEY=your-api-key-here

# 服务器端口
PORT=3001
```

### 两种扫描模式对比

| 模式 | 优点 | 缺点 | 适用场景 |
|------|------|------|----------|
| **traditional** | ✅ 快速稳定<br>✅ 无需外部API<br>✅ 离线可用<br>✅ 成本低 | ⚠️ 规则固定<br>⚠️ 可能漏报 | 日常开发、快速扫描 |
| **ai** | ✅ 智能分析<br>✅ 发现深层问题<br>✅ 详细建议 | ⚠️ 需要网络<br>⚠️ API 费用<br>⚠️ 响应较慢 | 深度安全审计 |

---

## 📡 API 端点

### 健康检查
```bash
GET /api/health
```

### 单文件扫描
```bash
POST /api/scan/upload
Content-Type: multipart/form-data

字段:
- file: 代码文件
```

### 文件夹扫描
```bash
POST /api/scan/upload-folder
Content-Type: multipart/form-data

字段:
- files: 多个代码文件
```

### 支持的文件类型
- JavaScript: `.js`, `.jsx`
- TypeScript: `.ts`, `.tsx`
- Python: `.py`
- PHP: `.php`
- Java: `.java`
- C/C++: `.c`, `.cpp`
- Go: `.go`
- Ruby: `.rb`

---

## 🧪 测试后端

### 使用 curl 测试

```bash
# 1. 创建测试文件
cat > test.js << 'EOF'
function login(username, password) {
  const query = "SELECT * FROM users WHERE name = '" + username + "'";
  eval(userInput);
  const apiKey = "hardcoded-secret-123";
}
EOF

# 2. 上传扫描
curl -X POST http://localhost:3001/api/scan/upload \
  -F "file=@test.js"

# 3. 清理
rm test.js
```

---

## 📊 使用前端界面

1. 访问 `http://localhost:3000`
2. 点击 "漏洞分析" 页面
3. 选择上传模式：
   - 📁 **项目文件夹**: 批量扫描整个项目
   - 📄 **单个文件**: 扫描单个代码文件
4. 拖拽或点击上传
5. 查看扫描结果和修复建议

---

## 🛠️ 故障排查

### 后端无法启动

```bash
# 检查端口占用
lsof -i :3001

# 如果端口被占用，杀死进程
kill -9 <PID>

# 清理并重新安装依赖
cd backend
rm -rf node_modules package-lock.json
npm install
npm start
```

### 前端无法连接后端

```bash
# 1. 确认后端运行
curl http://localhost:3001/api/health

# 2. 检查前端 API 配置
# src/components/pages/VulnerabilityAnalysis.tsx
# 确保 API_BASE_URL = 'http://localhost:3001/api'
```

### 扫描失败

1. **AI 模式失败**: 
   - 检查 DeepSeek API Key 是否有效
   - 确认网络连接
   - 切换到 traditional 模式

2. **AST 解析失败**:
   - 确认代码语法正确
   - 检查文件编码（应为 UTF-8）

---

## 🔒 安全功能

### Traditional 模式检测的漏洞类型

✅ **SQL 注入**: 字符串拼接构建 SQL 查询
✅ **XSS 攻击**: innerHTML、dangerouslySetInnerHTML
✅ **代码注入**: eval()、exec() 使用
✅ **硬编码凭证**: 密码、API Key 写在代码中
✅ **不安全加密**: MD5、SHA1、DES 等弱算法
✅ **不安全连接**: HTTP 而非 HTTPS
✅ **命令注入**: 系统命令执行
✅ **不安全反序列化**: pickle、ObjectInputStream
✅ **XML 外部实体注入**: XXE 漏洞
✅ **文件包含漏洞**: 不安全的 include/require

---

## 📈 系统性能

- ⚡ 单文件扫描: < 1 秒
- 📦 项目扫描 (100 文件): < 10 秒
- 💾 文件大小限制: 10MB
- 🔢 最大文件数: 100

---

## 🎯 下一步

### 切换到 AI 模式（可选）

1. 获取有效的 DeepSeek API Key
2. 编辑 `backend/.env`:
   ```env
   SCAN_MODE=ai
   DEEPSEEK_API_KEY=sk-your-real-api-key
   ```
3. 重启后端服务
4. AI 模式提供更智能的分析和修复建议

### 部署到生产环境

1. 构建前端:
   ```bash
   npm run build
   ```

2. 配置环境变量

3. 使用 PM2 或类似工具管理后端进程

---

## 📞 支持

如有问题，请检查：
1. Node.js 版本 >= 16.x
2. 所有依赖已正确安装
3. 端口 3000 和 3001 未被占用
4. 网络连接正常（AI 模式）

---

## ✨ 特性

- 🎨 精美的赛博朋克风格界面
- 🌍 中英文双语支持
- 🔍 实时代码扫描
- 📊 详细的漏洞报告
- 💡 智能修复建议
- 📁 支持文件和文件夹扫描
- 🎯 多语言支持

---

**祝你使用愉快！🚀**

